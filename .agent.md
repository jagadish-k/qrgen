# QR Code Generator Chrome Extension - Developer Guide

## Project Overview

This is a Chrome Extension (Manifest V3) for generating **colorful QR codes with embedded images**. The extension opens as a full-page tab (similar to JSONView) when clicked, providing a spacious and user-friendly interface. It supports 12 different QR code types including plain text, URLs, phone numbers, SMS, email, WhatsApp, FaceTime, location sharing, Wi-Fi networks, calendar events, contact cards (vCard), and UPI payments.

### Key Features
- **Modular Architecture** - Refactored from monolithic to component-based structure
- **Dark Mode Support** - Complete theming with smooth transitions
- **Image Embedding** - Center-embedded images with color extraction
- **Gradient Themes** - Dynamic gradient backgrounds for colorful QR codes
- **Google Maps Integration** - Parse Maps URLs to extract coordinates
- **Advanced Validation** - Comprehensive input validation for all QR types
- **Responsive Design** - Full-page tab interface with neumorphism styling

## Recent Refactoring (2024)

The project underwent a major architectural refactoring to improve maintainability and developer experience:

### Before Refactoring
- **Monolithic Structure** - Single 1600+ line App.tsx file
- **Mixed Concerns** - UI, business logic, and data management in one place
- **Code Duplication** - Repeated validation and data generation logic
- **Hard to Maintain** - Difficult to add new QR types or modify existing ones

### After Refactoring
- **Modular Architecture** - 28 focused files across organized directories
- **Separation of Concerns** - Clear boundaries between UI, logic, and data
- **Reusable Components** - Shared components and custom hooks
- **Type Safety** - Comprehensive TypeScript interfaces and utilities
- **Easy Extension** - Simple process to add new QR types and features

### Benefits Achieved
- **90% Code Reduction** - Main App.tsx reduced from 1600+ to ~400 lines
- **Better Performance** - Optimized with proper component separation and hooks
- **Improved DX** - Clear file structure and development patterns
- **Enhanced Testing** - Isolated functions and components for easier testing
- **Consistent Styling** - Unified dark mode support across all components

## Technology Stack

- **Frontend:** React 18 with TypeScript (strict mode)
- **Build System:** Vite 4.3+ with React plugin and hot reload
- **Styling:** Tailwind CSS 3.3+ with PostCSS and custom neumorphism design
- **QR Code Generation:** qrious 4.0.2 library with high error correction
- **Color Analysis:** colorthief 2.4.0 for extracting dominant colors from images
- **Icons:** React Icons 5.5+ (Feather icon set)
- **Extension:** Chrome Extension Manifest V3 with service worker
- **Development:** ESLint, Prettier, TypeScript 5.0+ for code quality

## Architecture & File Structure

### Core Extension Files
- `manifest.json` - Chrome extension manifest (V3) with tabs permission
- `background.js` - Service worker that opens new tab when extension clicked
- `index.html` - Full-page tab entry point (minimal, processed by Vite)

### React Application (Modular Structure)
- `src/App.tsx` - Main React component (refactored to ~400 lines)
- `src/index.tsx` - React rendering entry point
- `src/index.css` - Tailwind CSS imports and custom neumorphism styles

### Type Definitions
- `src/types/index.ts` - Centralized TypeScript interfaces and types
- `src/types/colorthief.d.ts` - TypeScript type definitions for colorthief
- `src/types/qrious.d.ts` - TypeScript type definitions for qrious

### Constants & Configuration
- `src/constants/qrTypes.ts` - QR type cards configuration and fallback gradients

### Utility Functions
- `src/utils/qrDataGenerator.ts` - QR data generation logic for all types
- `src/utils/validation.ts` - Input validation utilities
- `src/utils/colorUtils.ts` - Color extraction and gradient utilities
- `src/utils/urlUtils.ts` - URL parsing and Google Maps integration

### Custom Hooks
- `src/hooks/useToast.ts` - Toast notification management
- `src/hooks/useTooltip.ts` - Tooltip display management
- `src/hooks/useDarkMode.ts` - Dark mode state and persistence
- `src/hooks/useGradients.ts` - Gradient fetching and management

### Reusable Components
- `src/components/QRTypeSelector.tsx` - QR type selection grid
- `src/components/QRFormRenderer.tsx` - Dynamic form renderer for all QR types
- `src/components/GradientSelector.tsx` - Gradient selection interface
- `src/components/ImageUpload.tsx` - Image upload and color extraction
- `src/components/QRCodeGenerator.tsx` - QR code generation with canvas
- `src/components/DarkModeToggle.tsx` - Dark mode toggle button
- `src/components/ToastNotification.tsx` - Toast notification display
- `src/components/TooltipDisplay.tsx` - Tooltip display component

### Form Components
- `src/components/forms/TextForm.tsx` - Text input form
- `src/components/forms/URLForm.tsx` - URL input form
- `src/components/forms/PhoneForm.tsx` - Phone number form
- `src/components/forms/WiFiForm.tsx` - WiFi configuration form
- `src/components/forms/index.ts` - Form component exports

### Build Configuration
- `vite.config.ts` - Vite configuration for Chrome extension build
- `tailwind.config.js` - Tailwind CSS configuration with neumorphism theme
- `postcss.config.js` - PostCSS configuration
- `tsconfig.json` - TypeScript configuration with strict mode

### Development Tools
- `.eslintrc.json` - ESLint configuration for React/TypeScript
- `.prettierrc` - Prettier code formatting configuration
- `scripts/create-icons.js` - Node.js script to generate extension icons using Canvas

### Documentation
- `REQUIREMENTS.md` - Detailed project requirements and specifications
- `CLAUDE.md` - Legacy guidance file (content migrated to this file)
- `icons/README.md` - Icon requirements and specifications
- `.agent.md` - This comprehensive developer guide

## Key Features Implementation

### QR Code Types Supported (12 Total)
- **Plain Text** - Any text content with textarea input
- **URLs** - Website links with URL validation
- **Phone Numbers** - Direct call links with tel: protocol
- **SMS Messages** - Pre-filled text messages with phone number
- **Email** - Pre-composed emails with subject/body fields
- **WhatsApp** - Direct WhatsApp messages via wa.me links
- **FaceTime** - Apple FaceTime video calls (facetime: protocol)
- **Location** - GPS coordinates with Google Maps URL parsing
- **Wi-Fi Networks** - SSID, password, encryption type (WPA/WEP/none)
- **Calendar Events** - vCalendar format with start/end dates
- **Contact Cards** - vCard format with name, phone, email, organization
- **UPI Payments** - Indian payment system with payee details

### Advanced Features
- **Image Embedding** - Center-embedded images with 20% size ratio and white background
- **Color Analysis** - Extracts 3 dominant colors from uploaded images using colorthief
- **Colorful QR Codes** - Uses extracted colors for foreground, background, and borders
- **Gradient Backgrounds** - Fetches gradients from UIGradients API with fallbacks
- **Google Maps Integration** - Parses various Maps URL formats to extract coordinates
- **Dark Mode** - Complete theming with localStorage persistence and system preference detection
- **Error Correction** - High level ('H') for scanability with embedded images
- **Download** - PNG format export functionality (400x400px)
- **Responsive UI** - Full-page design with custom neumorphism styling
- **Toast Notifications** - Custom toast system for user feedback (no native alerts)
- **Tooltip System** - Contextual help with proper cleanup on navigation

## Development Commands

### Setup & Building
```bash
npm install                 # Install dependencies
npm run build              # Build extension (includes icon generation)
npm run dev                # Watch mode for development with hot reload
npm run clean              # Remove build directory
```

### Code Quality & Development
```bash
npm run typecheck          # Run TypeScript type checking (strict mode)
npm run lint               # Run ESLint with auto-fix for React/TypeScript
npm run format             # Format code with Prettier
npm run test               # Run tests (placeholder - no tests configured yet)
```

### Icon Generation
```bash
npm run create-icons       # Generate extension icons using Node.js Canvas
```

### Loading the Extension
1. **Build**: Run `npm run build` to create the build directory
2. **Chrome Extensions**: Navigate to `chrome://extensions/`
3. **Developer Mode**: Enable "Developer mode" toggle
4. **Load Extension**: Click "Load unpacked" and select the `build/` directory
5. **Test**: Click the QR Code Generator extension icon to open in a new tab

### Development Workflow
1. **Make Changes**: Edit source files in `src/`
2. **Watch Mode**: Use `npm run dev` for automatic rebuilds
3. **Reload Extension**: Click reload button in `chrome://extensions/`
4. **Test**: Refresh the extension tab to see changes
5. **Debug**: Use Chrome DevTools on the extension tab

## Technical Constraints & Best Practices

### Chrome Extension Requirements
- **Manifest V3** - Uses service worker instead of background pages
- **Content Security Policy** - Strict CSP for security
- **Client-side only** - All QR generation, image processing, and color analysis happen in the browser
- **No native dialogs** - Uses custom toast system instead of alert()/confirm()
- **Tabs permission** - Required for opening new tabs

### Code Quality Standards
- **TypeScript strict mode** - All code must be properly typed
- **ESLint configuration** - React/TypeScript rules with auto-fix
- **Prettier formatting** - Consistent code formatting
- **No unused variables** - Enforced by TypeScript and ESLint

### UI/UX Guidelines
- **Neumorphism design** - Soft, tactile interface with custom shadows
- **Dark mode support** - Full dark/light theme switching
- **Responsive design** - Must adapt to full-page tab dimensions
- **Accessibility** - Proper contrast ratios and keyboard navigation
- **Performance** - Optimized image processing and QR generation

## Key Dependencies

### Production Dependencies
- `react` + `react-dom` - UI framework (v18.2.0)
- `qrious` - QR code generation library (v4.0.2)
- `colorthief` - Color analysis and extraction from images (v2.4.0)
- `react-icons` - Feather icons for UI (v5.5.0)

### Development Dependencies
- `@vitejs/plugin-react` - Vite React plugin (v4.0.0)
- `tailwindcss` - Utility-first CSS framework (v3.3.0)
- `typescript` - Type checking (v5.0.0)
- `canvas` - Node.js Canvas for icon generation (v2.11.2)
- `eslint` + `prettier` - Code quality tools

## Color Analysis Features

The extension uses the colorthief library for advanced color processing:

1. **Color Extraction** - Extracts 3 dominant colors from uploaded images
2. **Color Mapping** - Maps colors to:
   - Primary: QR code foreground color
   - Secondary: Image border color  
   - Background: QR code background color
3. **Color Preview** - Shows extracted colors in the UI
4. **Gradient Support** - Pre-defined gradient options
5. **Colorful QR Codes** - Applies extracted colors to generate vibrant QR codes

## QR Code Specifications

- **Error correction level:** 'H' (High) for reliable scanning with embedded images
- **Image embedding:** 20% of total QR code size with white background
- **Output format:** PNG for download (400x400px)
- **Color customization:** Dynamic colors based on image analysis
- **Validation:** Input validation for all QR code types

## Build System Details

The project uses Vite for modern bundling with:
- **TypeScript compilation** - Full type checking and compilation
- **React JSX transformation** - Modern JSX transform
- **Tailwind CSS processing** - PostCSS pipeline with autoprefixer
- **Asset optimization** - File hashing and minification
- **Extension manifest copying** - Automatic manifest and background script copying
- **Icon generation** - Automated icon creation using Node.js Canvas

## Common Development Tasks

### Adding New QR Code Types
1. Add new type to `QRCodeType` union in `src/types/index.ts`
2. Add card definition to `QR_TYPE_CARDS` array in `src/constants/qrTypes.ts`
3. Create form component in `src/components/forms/`
4. Add form to `QRFormRenderer.tsx`
5. Add data processing logic in `src/utils/qrDataGenerator.ts`
6. Add validation logic in `src/utils/validation.ts`

### Creating New Components
- Follow the established pattern in `src/components/`
- Use TypeScript interfaces for props
- Import types from `src/types/index.ts`
- Use custom hooks for state management
- Follow neumorphism design patterns

### Adding New Hooks
- Create in `src/hooks/` directory
- Follow naming convention `use[HookName].ts`
- Return object with state and handlers
- Use TypeScript for type safety

### Modifying UI Styling
- Use Tailwind classes with neumorphism utilities
- Custom styles in `src/index.css` using `@layer` directives
- Dark mode variants using `dark:` prefix
- Neumorphism shadows defined in `tailwind.config.js`

### Debugging Extension
- Use Chrome DevTools on the extension tab
- Check `chrome://extensions/` for error messages
- View console logs in the extension's DevTools
- Test manifest changes by reloading the extension

### Performance Optimization
- **Async Processing** - Image processing and color analysis done asynchronously
- **Optimized Rendering** - QR code generation uses requestAnimationFrame
- **Debounced Operations** - Color analysis debounced for large images
- **Memory Management** - Canvas operations optimized for memory usage
- **Component Optimization** - Proper memoization and hook dependencies
- **Lazy Loading** - Components loaded on demand with code splitting
- **Efficient State** - Custom hooks prevent unnecessary re-renders

## Code Organization Best Practices

### Component Structure
- Keep components small and focused (single responsibility)
- Use TypeScript interfaces for all props
- Separate business logic into custom hooks
- Use utility functions for complex operations

### State Management
- Use custom hooks for complex state logic
- Keep component state minimal and focused
- Use callback functions for parent-child communication
- Implement proper error boundaries

### File Organization
- Group related files in directories (`components/`, `hooks/`, `utils/`)
- Use index files for clean imports
- Keep constants and types in dedicated files
- Separate form components by functionality

### Type Safety
- Define interfaces for all data structures
- Use union types for controlled values
- Implement proper error handling with typed responses
- Use generic types where appropriate

## Security Considerations

- **Content Security Policy** - Strict CSP prevents XSS attacks
- **No external requests** - All processing is client-side
- **File upload validation** - Image files are validated before processing
- **Input sanitization** - All user inputs are validated and sanitized
- **Manifest V3 compliance** - Uses latest security standards
- **Type safety** - TypeScript prevents runtime errors

## Testing & Debugging

### Manual Testing Checklist
- **QR Code Types** - Test all 12 QR code types with various inputs
- **Image Formats** - Test with PNG, JPG, GIF, WebP images
- **Dark Mode** - Verify all components work in both light and dark themes
- **Responsive Design** - Test on different screen sizes and zoom levels
- **Error Handling** - Test invalid inputs and edge cases
- **Performance** - Test with large images and complex QR codes
- **Cross-browser** - Ensure compatibility with Chrome/Chromium variants

### Debugging Tools
- **Chrome DevTools** - Use on the extension tab for debugging
- **Extension Console** - Check `chrome://extensions/` for error messages
- **TypeScript Errors** - Run `npm run typecheck` for type issues
- **Linting Issues** - Run `npm run lint` for code quality problems
- **Network Tab** - Monitor gradient API calls and image loading
- **React DevTools** - Install React DevTools extension for component debugging

### Common Issues & Solutions
- **Build Failures** - Check TypeScript errors and missing dependencies
- **Extension Not Loading** - Verify manifest.json and build output
- **QR Code Not Generating** - Check console for canvas or validation errors
- **Dark Mode Issues** - Ensure all components have dark: variants
- **Tooltip Persistence** - Verify proper cleanup in component unmounting

## Project Status & Roadmap

### Current Status (v1.0.0)
- ✅ **Core Functionality** - All 12 QR code types implemented and working
- ✅ **Modular Architecture** - Complete refactoring to component-based structure
- ✅ **Dark Mode** - Full theming support with proper color schemes
- ✅ **Image Processing** - Color extraction and embedding working reliably
- ✅ **Gradient Integration** - UIGradients API integration with fallbacks
- ✅ **Google Maps** - URL parsing for location QR codes
- ✅ **Type Safety** - Comprehensive TypeScript coverage
- ✅ **Build System** - Vite-based build with icon generation
- ✅ **Extension Ready** - Chrome Extension Manifest V3 compliant

### Known Limitations
- **No Tests** - Test suite not yet implemented (placeholder script exists)
- **Single Browser** - Chrome/Chromium only (by design for extension)
- **API Dependency** - Gradient fetching relies on external UIGradients API
- **No Offline Mode** - Requires internet for gradient themes (has fallbacks)

### Future Enhancements (Potential)
- **Test Suite** - Unit and integration tests for components and utilities
- **More QR Types** - Additional QR code formats (Bitcoin, social media, etc.)
- **Custom Gradients** - User-defined gradient creation
- **Export Options** - SVG export, different sizes, batch generation
- **Templates** - Pre-configured QR code templates
- **Analytics** - Usage tracking and popular QR types
- **Accessibility** - Enhanced screen reader support and keyboard navigation

### Contributing Guidelines
- **Code Style** - Follow existing patterns and use provided linting/formatting
- **TypeScript** - All new code must be properly typed
- **Components** - Keep components small, focused, and reusable
- **Dark Mode** - Ensure all new UI elements support dark theme
- **Documentation** - Update this file when adding new features
- **Testing** - Add tests when test suite is implemented

### Architecture Decisions
- **Full-Page Tab** - Chosen over popup for better UX and space
- **Client-Side Only** - No backend dependencies for security and simplicity
- **Neumorphism Design** - Custom design system for modern, tactile feel
- **Modular Structure** - Prioritizes maintainability over initial simplicity
- **TypeScript Strict** - Enforces type safety and prevents runtime errors
- **Vite Build** - Modern tooling for fast development and optimized builds